title: 线程安全
date: 2016-11-14 20:15:30
updated: 2017-02-21 16:14:02
tags:
- C++
categories:
- Study
- Computer
- PL
- C++
- Thread
---
# 1 对象的创建

对象构造要做到线程安全，唯一的要求是在构造期间不要泄露`this`指针，即：

- 不要在构造函数中注册任何回调
- 不要哦在构造函数中把`this`指针传给跨线程的对象
- 即便在构造函数的最后一行也不行

之所以这样规定，是因为在构造函数执行期间对象还没完成初始化，如果`this`指针被泄露给了其他对象(其自身创建的子对象除外)，那么别的线程有可能访问这个半成品对象，这会造成难以预料的后果。
而不允许在最后一行泄露`this`，是考虑到可能改类可能是基类，又因为基类先于派生类构造，故执行完最后一句后仍会继续派生类的构造，从而有可能发生错误。