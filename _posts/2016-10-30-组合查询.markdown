---
layout: post
author: LPF
title: 组合查询
date: 2016-10-30 09:34:40
updated: 2017-02-21 15:16:42
categories:
- Study
- DataBase
- MySQL
---

## 1 组合查询

MySQL允许执行多个查询(多条SELECT语句)，并将结果作为单个查询结果集返回。这些组合查询通常称为并(**union**)或复合查询(**compound query**)。

### 1.1 使用组合查询的情况

- 在单个查询中从不同的表返回类似结构的数据
- 对单个表执行多个查询，按单个查询返回数据

### 1.2 组合查询与多个WHERE子句

多数情况下，组合相同表的两个查询完成的工作与具有多个**WHERE**子句条件的单条查询完成的工作相同。换句话说，任何具有多个**WHERE**子句的**SELECT**语句都可以作为一个组合查询给出，在以下段落中可以看到这一点。这两种技术在不同的查询中性能也不同。因此，应该试一下这两种技术，以确定对特定的查询哪一种性能更好。

## 2 创建组合查询

### 2.1 使用UNION

**UNION**的使用很简单。所需做的只是给出每条**SELECT**语句，在各条语句之间放上关键字**UNION**。 

```SQL
SELECT ID, name
FROM city
WHERE ID < 10
UNION 
SELECT ID, name
FROM city
WHERE Population IN (100000, 300000);
```

上述例子将取出两条SELECT语句的并集，并把输出结果合成单个查询结果集。其与下列方式实现所获得的结果一致。

```SQL
SELECT ID, name
FROM city
WHERE ID < 10
    OR Population IN (100000, 300000);
```

### 2.2 UNION与多个WHERE语句对比

在上述这个简单的例子中，使用UNION可能比使用WHERE子句更为复杂。
但对于更复杂的过滤条件，或者从多个表（而不是单个表）中检索数据的情形，使用UNION可能会使处理更简单。

### 2.3 UNION规则

- **UNION**必须由两条或两条以上的**SELECT**语句组成，语句之间用关键字**UNION**分隔
- **UNION**中的每个查询必须包含相同的列、表达式或聚集函数(不要求以相同的顺序)
- 列数据类型必须兼容：类型不必完全相同，但必须是DBMS可以隐含地转换的类型(例如，不同的数值类型或不同的日期类型)。 

## 3 包含或取消重复的行

### 3.1 取消重复

**UNION**会从查询结果集中自动去除了重复的行。

### 3.2 包含重复

如果需要返回所有匹配的行，可以使用**UNION ALL**。
此时，将会有若干行是重复的。其做到了多个**WHERE**子句无法做到的事情，因为WHERE总是自动去除重复行。



