---
layout: post
author: LPF
title: 分支预测
date: 2016-08-10 19:33:27
updated: 2017-02-21 16:15:41
tags:
- Principle
categories:
- Study
- Computer
- Hardware
- advanced
author: LPF
---
## 1 分支预测

分支预测的核心问题是，**转移**是发生还是不发生。

在指令还没有执行时，处理器就必须提前预测相等的条件下该指令执行是否成立。
这是很困难的，但在统计学角度看，有些事情一旦出现，下次再次出现的概率较大，如循环。

当某条转移指令第一次执行时，**转移**则发生了，那么处理器可以预测，下一次它还会继续转移，而不是顺序执行。

## 2 高速缓存器

在处理器内部，有一个小容量的高速缓存区——分支目标缓存器(Branch Target Buffer,BTB)。

- 当处理器执行了一条分支语句后，它会在**BTB**中记录当前指令的地址、分支目标的地址及本次分支预测的结果。
- 下一次，在那条转移指令实际执行前，处理器会查找**BTB**，看有没有最近的转移记录。
- 如果能找到对应的条目，则推测执行和上一次相同的分支，把该分支的指令送入流水线。
- 当该指令实际执行时，如果预测是失败的，则清空流水线，同时刷新**BTB**中的记录。